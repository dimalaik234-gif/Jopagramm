<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jopagramm ‚Äî Messenger</title>
    <style>
        :root {
            --bg-color: #0f0f12;
            --sidebar-color: #1a1a1f;
            --accent-color: #8b5cf6;
            --text-color: #e2e8f0;
            --msg-user: #4c1d95;
            --msg-other: #2d2d35;
        }

        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); height: 100vh; overflow: hidden; }

        /* --- Auth Screen --- */
        #auth-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 1000; display: flex;
            justify-content: center; align-items: center;
        }

        .auth-card {
            background: var(--sidebar-color); padding: 30px; border-radius: 20px;
            width: 300px; text-align: center; border: 1px solid var(--accent-color);
        }

        input {
            width: 90%; padding: 12px; margin: 10px 0; border-radius: 10px;
            border: 1px solid #333; background: #2d2d35; color: white;
        }

        button {
            background: var(--accent-color); color: white; border: none;
            padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold;
        }

        /* --- Main App --- */
        .app-container { display: none; height: 100vh; }

        .sidebar {
            width: 300px; background: var(--sidebar-color);
            border-right: 1px solid #333; display: flex; flex-direction: column;
        }

        .tabs { display: flex; background: #111; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom: 2px solid var(--accent-color); color: var(--accent-color); }

        .list-container { flex: 1; overflow-y: auto; }
        .item { padding: 15px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
        .item:hover { background: #2d2d35; }

        .main-chat { flex: 1; display: flex; flex-direction: column; }
        .chat-header { padding: 15px; background: var(--sidebar-color); border-bottom: 1px solid #333; }
        #messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 70%; padding: 10px 15px; border-radius: 15px; }
        .msg-mine { align-self: flex-end; background: var(--msg-user); }
        .msg-other { align-self: flex-start; background: var(--msg-other); }

        .input-area { padding: 15px; background: var(--sidebar-color); display: flex; gap: 10px; }
        
        .add-friend-btn { font-size: 0.8rem; background: #22c55e; padding: 5px 10px; }

        /* Secret Pelmeni */
        .pelmeni-mode { filter: sepia(1) hue-rotate(45deg); animation: shake 0.2s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <h1>Jopagramm</h1>
        <p>–í—Ö–æ–¥ –±–µ–∑ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>
        <input type="text" id="reg-nick" placeholder="–ü—Ä–∏–¥—É–º–∞–π –Ω–∏–∫–Ω–µ–π–º">
        <input type="password" id="reg-pass" placeholder="–ü—Ä–∏–¥—É–º–∞–π –ø–∞—Ä–æ–ª—å">
        <button onclick="handleAuth()">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    </div>
</div>

<div class="app-container" id="main-app">
    <div class="sidebar">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('chats')">–ß–∞—Ç—ã</div>
            <div class="tab" onclick="switchTab('friends')">–î—Ä—É–∑—å—è</div>
            <div class="tab" onclick="switchTab('search')">–ü–æ–∏—Å–∫</div>
        </div>
        
        <div id="sidebar-content" class="list-container">
            </div>

        <div class="item" style="cursor:pointer" onclick="openSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (<span id="my-nick"></span>)</div>
    </div>

    <div class="main-chat">
        <div class="chat-header">
            <h3 id="chat-title">–í—ã–±–µ—Ä–∏—Ç–µ, –∫–æ–º—É –Ω–∞–ø–∏—Å–∞—Ç—å</h3>
        </div>
        <div id="messages"></div>
        <div class="input-area">
            <input type="text" id="msg-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="sendMsg()">üöÄ</button>
        </div>
    </div>
</div>

<script>
    // --- –î–ê–ù–ù–´–ï (–°–∏–º—É–ª—è—Ü–∏—è) ---
    let myData = JSON.parse(localStorage.getItem('jopa_user')) || null;
    let friends = JSON.parse(localStorage.getItem('jopa_friends')) || [];
    let mockUsers = ["–ü–µ–ª—å–º–µ–Ω—å_228", "–ê–¥–º–∏–Ω_Jopa", "–ö—Ä—É—Ç–æ–π_–ß–µ–ª–∏–∫", "–ú–∞–º–∞_–°—Ç–∏—Ñ–ª–µ—Ä–∞"];

    // --- –õ–û–ì–ò–ö–ê –í–•–û–î–ê ---
    function handleAuth() {
        const nick = document.getElementById('reg-nick').value;
        const pass = document.getElementById('reg-pass').value;

        if (nick.length < 3) return alert("–ù–∏–∫ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π!");

        myData = { nickname: nick, password: pass, bio: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Jopagramm" };
        localStorage.setItem('jopa_user', JSON.stringify(myData));
        showApp();
    }

    function showApp() {
        if (!myData) return;
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('my-nick').textContent = myData.nickname;
        switchTab('chats');
    }

    // --- –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ---
    function switchTab(type) {
        const container = document.getElementById('sidebar-content');
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(t => t.classList.remove('active'));
        
        container.innerHTML = "";

        if (type === 'chats') {
            tabs[0].classList.add('active');
            container.innerHTML = `<div class="item" onclick="openChat('–û–±—â–∏–π —á–∞—Ç')">üí¨ –û–±—â–∏–π —á–∞—Ç</div>`;
            friends.forEach(f => {
                container.innerHTML += `<div class="item" onclick="openChat('${f}')">üë§ ${f}</div>`;
            });
        } 
        else if (type === 'friends') {
            tabs[1].classList.add('active');
            if (friends.length === 0) container.innerHTML = "<p style='padding:20px'>–î—Ä—É–∑–µ–π –ø–æ–∫–∞ –Ω–µ—Ç :(</p>";
            friends.forEach(f => {
                container.innerHTML += `<div class="item"><span>üë§ ${f}</span><button onclick="removeFriend('${f}')" style="background:red; font-size:10px">–£–¥–∞–ª–∏—Ç—å</button></div>`;
            });
        } 
        else if (type === 'search') {
            tabs[2].classList.add('active');
            container.innerHTML = `<div style="padding:10px"><input type="text" id="user-search" placeholder="–ò—Å–∫–∞—Ç—å –Ω–∏–∫..." oninput="doSearch()"></div><div id="search-results"></div>`;
        }
    }

    // --- –ü–û–ò–°–ö –ò –î–†–£–ó–¨–Ø ---
    function doSearch() {
        const query = document.getElementById('user-search').value.toLowerCase();
        const results = document.getElementById('search-results');
        results.innerHTML = "";
        
        if (query === "") return;

        mockUsers.filter(u => u.toLowerCase().includes(query)).forEach(u => {
            results.innerHTML += `
                <div class="item">
                    <span>${u}</span>
                    ${friends.includes(u) ? '‚úÖ' : `<button class="add-friend-btn" onclick="addFriend('${u}')">–î–æ–±–∞–≤–∏—Ç—å</button>`}
                </div>`;
        });
    }

    function addFriend(name) {
        if (!friends.includes(name)) {
            friends.push(name);
            localStorage.setItem('jopa_friends', JSON.stringify(friends));
            switchTab('search');
            alert(name + " —Ç–µ–ø–µ—Ä—å —Ç–≤–æ–π –¥—Ä—É–≥!");
        }
    }

    function removeFriend(name) {
        friends = friends.filter(f => f !== name);
        localStorage.setItem('jopa_friends', JSON.stringify(friends));
        switchTab('friends');
    }

    // --- –ß–ê–¢ ---
    function openChat(name) {
        document.getElementById('chat-title').textContent = "–ß–∞—Ç —Å: " + name;
        document.getElementById('messages').innerHTML = `<div class="msg msg-other">–í—ã –Ω–∞—á–∞–ª–∏ –¥–∏–∞–ª–æ–≥ —Å ${name}</div>`;
    }

    function sendMsg() {
        const input = document.getElementById('msg-input');
        if (!input.value) return;
        const msgDiv = document.createElement('div');
        msgDiv.className = "msg msg-mine";
        msgDiv.textContent = input.value;
        document.getElementById('messages').appendChild(msgDiv);
        input.value = "";
        document.getElementById('messages').scrollTop = 9999;
    }

    // --- –°–ï–ö–†–ï–¢–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
    function openSettings() {
        const code = prompt("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞:");
        if (code === "–ø–µ–ª—å–º–µ–Ω–∏") {
            document.body.classList.toggle('pelmeni-mode');
            alert("–†–ï–ñ–ò–ú –ü–ï–õ–¨–ú–ï–ù–ï–ô –í–ö–õ–Æ–ß–ï–ù! ü•ü");
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (myData) showApp();

</script>
</body>
</html>
